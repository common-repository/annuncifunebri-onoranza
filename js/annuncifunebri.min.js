function writeLog(a,b,c){jQuery.ajax({url:"https://api.annuncifunebri.it/v2/writeLog",data:{table:a,url:b,description:c},method:"POST",crossDomain:!0,dataType:"jsonp"})}jQuery(".annfu_epigrafe_wrapper a.annfu_lightbox").length&&jQuery(".annfu_epigrafe_wrapper a.annfu_lightbox").colorbox({rel:"epigrafe",maxWidth:"90%",maxHeight:"90%"}),jQuery("#annfu_telefono").on("keyup",function(){var a=jQuery(this).val().replace(/[^\+0-9]+/g,"");jQuery(this).val(a)}),jQuery("#annfu_invio").on("click",function(){if(!jQuery(".annfu_dati_personali").prop("checked"))return confirm("Inviando il cordoglio acconsentirai al trattamento dei tuoi dati personali")}),jQuery("#annfu_form_cordoglio form").on("submit",function(){var a="",h=jQuery("#annfu_token").val(),f=jQuery("#annfu_hash").val(),b=jQuery("#annfu_nome").val(),c=jQuery("#annfu_mail").val(),d=jQuery("#annfu_telefono").val(),e=jQuery("#annfu_testo").val(),i=jQuery("#annfu_recapito").val(),g=jQuery("#annfu_visibile").prop("checked")?0:1;return jQuery("#annfu_invio").val("Sto inviando "+(""==e?"la partecipazione...":"il cordoglio...")),jQuery("#annfu_invio").prop("disabled",!0),Cookies.set("hash",f,{expires:365}),Cookies.set("cordoglio_nome",b,{expires:365}),Cookies.set("cordoglio_telefono",d,{expires:365}),Cookies.set("cordoglio_testo",e,{expires:365}),Cookies.set("cordoglio_visibile",g,{expires:365}),Cookies.set("cordoglio_data",new Date().toISOString().slice(0,10),{expires:365}),b.length<=3&&(a+="Il nome &egrave; obbligatorio (min 3 caratteri)<br/>"),""==c||/[@\.]/i.test(c)||(a+="L'email non &egrave; corretta<br/>"),/^\+?\d{9,13}$/gi.test(d)||(a+="Il numero di cellulare non \xe8 corretto<br/>"),""!=a?(jQuery("#annfu_errori").html(a),window.pagesense=window.pagesense||[],window.pagesense.push(["tagRecording","Errore cordoglio"])):(jQuery("#annfu_loading").removeClass("hidden"),jQuery.ajax({url:"https://api.annuncifunebri.it/v2/cordogli",data:{token:h,hash:f,nome:b,cognome:"",mail:c,telefono:d,testo:e,recapito:i,visibile:g,provenienza:3},type:"POST",crossDomain:!0,dataType:"jsonp",success:function(a){if("utente"in a){if(null===a.testo)jQuery(".annfu_partecipazioni").html('<div class="annfu_partecipazioni_wrapper">'+a.partecipazioni+"</div>");else if("utente"in a){var b='<div class="annfu_cordoglio annfu_cordoglio_in_approvazione clearfix"><div class="annfu_cordoglio_intestazione clearfix">'+(0==a.visibile?'<div class="annfu_cordoglio_non_visibile col-xs-12 mb-4 text-center"><strong><i class="fas fa-exclamation-triangle"></i> Questo cordoglio NON \xe8 pubblico; \xe8 visibile solamente su questo computer</strong></div>':"")+'<div class="col-xs-12"><strong>'+a.utente.nominativo+'</strong> <em>in attesa di lavorazione</em></div><div class="annfu_cordoglio_testo col-xs-12">'+a.testo+'</div><div class="annfu_data_cordoglio text-right col-xs-12">'+a.data_ita+"</div></div></div></div>";jQuery(".annfu_cordogli").prepend(b),Cookies.set("cordoglio_id",a.id,{expires:1})}jQuery(".annfu_form_cordoglio_wrapper").html(jQuery("#annfu_grazie").html())}else jQuery("#annfu_errori").html("Non &egrave; stato possibile inserire il cordoglio. Riprovare tra qualche minuto."),Cookies.set("cordoglio.error","Non &egrave; stato possibile inserire il cordoglio. Riprovare tra qualche minuto."),jQuery("#annfu_invio").val("invia"),jQuery("#annfu_invio").prop("disabled",!1)},error:function(a){jQuery("#annfu_errori").html("Non &egrave; stato possibile inserire il cordoglio. Riprovare tra qualche minuto"),Cookies.set("cordoglio.error","Non &egrave; stato possibile inserire il cordoglio. Riprovare tra qualche minuto"),location.reload(!0)}}),jQuery("#annfu_errori, #annfu_successo").html(""),jQuery("#annfu_testo").val(""),jQuery("#annfu_loading").addClass("hidden")),!1});var nameOffset,verOffset,ix,extra={page:window.location.href,os:"Unknown OS"};-1!=navigator.appVersion.indexOf("Win")&&(extra.os="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(extra.os="MacOS"),-1!=navigator.appVersion.indexOf("X11")&&(extra.os="Unix"),-1!=navigator.appVersion.indexOf("Linux")&&(extra.os="Linux");var nVer=navigator.appVersion,nAgt=navigator.userAgent;extra.browser=navigator.appName,extra.browser_version=""+parseFloat(navigator.appVersion),extra.user_agent=nAgt,-1!=(verOffset=nAgt.indexOf("Opera"))?(extra.browser="Opera",extra.browser_version=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("MSIE"))?(extra.browser="Microsoft Internet Explorer",extra.browser_version=nAgt.substring(verOffset+5)):-1!=(verOffset=nAgt.indexOf("Chrome"))?(extra.browser="Chrome",extra.browser_version=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))?(extra.browser="Safari",extra.browser_version=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(extra.browser_version=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(extra.browser="Firefox",extra.browser_version=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(extra.browser=nAgt.substring(nameOffset,verOffset),extra.browser_version=nAgt.substring(verOffset+1),browserName.toLowerCase()==browserName.toUpperCase()&&(browserName=navigator.appName)),-1!=(ix=extra.browser_version.indexOf(";"))&&(extra.browser_version=extra.browser_version.substring(0,ix)),-1!=(ix=extra.browser_version.indexOf(" "))&&(extra.browser_version=extra.browser_version.substring(0,ix)),extra.privacy=jQuery(".annfu_dati_personali").prop("checked")?1:0,jQuery("#annfu_form_cordoglio .controllato").on("keyup",function(){jQuery(this).val().length>=3&&jQuery.ajax({url:"https://api.annuncifunebri.it/v2/cordogliIniziati",data:{token:jQuery("#annfu_token").val(),hash:jQuery("#annfu_hash").val(),nome:jQuery("#annfu_nome").val(),mail:jQuery("#annfu_mail").val(),telefono:jQuery("#annfu_telefono").val(),testo:jQuery("#annfu_testo").val(),recapito:jQuery("#annfu_recapito").val(),visibile:jQuery("#annfu_visibile").prop("checked")?0:1,extra:JSON.stringify(extra)},type:"POST",crossDomain:!0,dataType:"jsonp",success:function(a){},error:function(a){}})}),jQuery(".annfu_dati_personali").on("click",function(){jQuery(this).is(":checked")?jQuery("#annfu_invio").prop("disabled",!1):jQuery("#annfu_invio").prop("disabled","disabled")}),jQuery("#annfu_form_foto form").on("submit",function(f){f.preventDefault();var c,a="",d=jQuery("#annfu_foto_files").val(),g=jQuery("#annfu_foto_token").val(),h=jQuery("#annfu_foto_hash").val(),b=jQuery("#annfu_foto_nome").val(),e=jQuery("#annfu_foto_telefono").val();return c={},jQuery("textarea.didascalia").each(function(){c[jQuery(this).data("file")]=jQuery(this).val()}),Cookies.set("cordoglio_nome",b,{expires:365}),""==b&&(a+="Il nome &egrave; obbligatorio<br/>"),/^\+?\d{9,13}$/gi.test(e)||(a+="Il numero di cellulare non \xe8 corretto<br/>"),""==d&&(a+="Devi caricare almeno una immagine<br/>"),jQuery("#annfu_foto_dati_personali").is(":checked")||(a+="Il trattamento dei dati personali &egrave; obbligatorio<br/>"),""!=a?jQuery("#annfu_foto_errori").html(a):(jQuery("#annfu_foto_errori, #annfu_foto_successo").html(""),jQuery("#annfu_loading").removeClass("annfu_none"),jQuery.ajax({url:"https://api.annuncifunebri.it/v2/cordogli/foto",data:{token:g,hash:h,nome:b,telefono:e,files:d,didascalie:c,referrer:window.location.href},type:"POST",crossDomain:!0,dataType:"jsonp",success:function(a){"testo"in a?(jQuery("#annfu_foto_successo").html(a.testo).removeClass("annfu_none"),jQuery("#annfu_foto_cordoglio .dz-preview").remove().end(),jQuery("#annfu_foto_files").val("")):jQuery("#annfu_foto_errori").html("Non &egrave; stato possibile inviare le foto. Riprovare tra qualche minuto")},error:function(a){Cookies.set("foto-cordoglio.error","Non &egrave; stato possibile inviare le foto. Riprovare tra qualche minuto")}}),jQuery("#annfu_loading").addClass("annfu_none")),!1}),Dropzone.autoDiscover=!1;var dz=jQuery("#annfu_foto_cordoglio").dropzone({url:"https://admin.annuncifunebri.it/api/v2/cordogli/foto/upload",headers:{"Cache-Control":null,"X-Requested-With":null},acceptedFiles:"image/*",addRemoveLinks:!0,maxFilesize:10,params:{annuncio:jQuery("#annfu_slug").data("annuncio")},init:function(){this.on("addedfile",function(a){jQuery("#annfu_foto_invio").prop("disabled",!0),jQuery("#annfu_foto_invio").val("Attendi il caricamento"),jQuery("#annfu_foto_invio").addClass("annfu_disabled")}),this.on("removedfile",function(c){var a=jQuery("#annfu_foto_files").val(),b=(a=""==a?[]:a.split(",")).indexOf(jQuery("#annfu_foto_hash").val()+"-"+c.name);b> -1&&a.splice(b,1),a=a.join(","),jQuery("#annfu_foto_files").val(a)}),this.on("complete",function(a){jQuery("#annfu_foto_invio").prop("disabled",!1),jQuery("#annfu_foto_invio").val("Invia"),jQuery("#annfu_foto_invio").removeClass("annfu_disabled")})},renameFile:function(a){return jQuery("#annfu_foto_hash").val()+"-"+a.name},success:function(b){var a=jQuery("#annfu_foto_files").val();(a=""==a?[]:a.split(",")).push(b.upload.filename),a=a.join(","),jQuery("#annfu_foto_files").val(a),jQuery(b.previewElement).find(".dz-image").append('<textarea data-file="'+b.upload.filename+'" class="didascalia" rows="2" maxlength="60" placeholder="Didascalia: max 60 caratteri"></textarea>')},dictDefaultMessage:"",dictRemoveFile:'<i class="fa fa-trash-o"></i> Elimina',dictCancelUpload:"Annulla upload",dictUploadCanceled:"Upload annullato",dictCancelUploadConfirmation:"Sei sicuro di voler annullare l'upload?",dictFileTooBig:"Il peso del file \xe8 troppo elevato ({{filesize}}Mb). Max {{maxFilesize}}Mb"});if(jQuery(".annfu_foto_cordogli").length){var c=jQuery(".annfu_foto_cordogli img").length,a=0;jQuery(".annfu_foto_cordogli img").each(function(){a+=jQuery(this).width()});var b=jQuery(".annfu_foto_cordogli").width();jQuery(".annfu_foto_cordogli").slick({mobileFirst:!0,dots:!(a<b),infinite:!(a<b),speed:300,slidesToShow:a<b?c:1,variableWidth:!0,autoplay:!(a<b),autoplaySpeed:2e3}),jQuery(".annfu_foto_cordogli a").colorbox({rel:"fc1",maxWidth:"90%",maxHeight:"90%"})}function controllaFiori(){var a=[],g=jQuery("input[name=fiore_id]:checked").val(),c=jQuery("#annfu_fiore_nome").val(),d=jQuery("#annfu_fiore_cognome").val(),e=jQuery("#annfu_fiore_telefono").val(),b=jQuery("#annfu_fiore_mail").val(),f=jQuery("#annfu_privacy_fiori").prop("checked");if(""==c&&""==d&&""==b&&""==e)a.push("Tutti i campi sono obbligatori");else if(f){g||a.push("Devi selezionare una composizione"),c.length<3&&a.push("Il nome &egrave; obbligatorio (min 3 caratteri)"),d.length<3&&a.push("Il cognome &egrave; obbligatorio (min 3 caratteri)");var h=/[@\.]/i;""==b||h.test(b)||a.push("L'email non &egrave; corretta"),/^\+?\d{9,13}$/gi.test(e)||a.push("Il numero di cellulare non \xe8 corretto")}else f||a.push("Devi accettare le condizioni della privacy");return""!=jQuery("#annfu_fiore_testo_fascia").val()&&jQuery(".annfu_totale_testo_fascia").html("<strong>Testo da inserire nella fascia</strong><br/>"+jQuery("#annfu_fiore_testo_fascia").val()),""!=jQuery("#annfu_fiore_testo_biglietto").val()&&jQuery(".annfu_totale_testo_biglietto").html("<strong>Testo da inserire nel biglietto</strong><br/>"+jQuery("#annfu_fiore_testo_biglietto").val()),jQuery(".annfu_totale_dati").html("<strong>Dati personali</strong><br/>"+c+" "+d+"<br/>Email: "+b+"<br/>Telefono: "+e),0==a.length?(jQuery("#annfu_error").html(""),jQuery("#annfu_ordina").prop("disabled",!1).removeClass("annfu_ordina_disabled"),writeLog("fiori",location.href,"compilato i dati anagrafici: "+c+","+d+","+b+","+e)):(jQuery("#annfu_error").html(a.join("<br/>")),jQuery("#annfu_ordina").prop("disabled","disabled").addClass("annfu_ordina_disabled")),a}function calcolaImporto(){return 1*(jQuery("input[name=fiore_id]:checked").data("importo")||0)}jQuery(".annfu_open_tab_foto").on("click",function(){jQuery("a[data-tab=foto]").click(),jQuery("html,body").animate({scrollTop:jQuery("#annfu_form_cordoglio_wrapper").offset().top-100},"slow")}),jQuery('a[data-toggle="tab"]').on("shown.bs.tab",function(a){"Fiori"==a.target.text&&jQuery(".annfu_fiori_wrapper").height()>410&&jQuery(".annfu_fiori_wrapper").addClass("scroll")}),jQuery(".annfu_fiore_dettagli").on("click",function(){html='<img src="'+jQuery(this).parent().find("img").attr("src")+'" class="annfu_fiore_grande" />',html+="<h2>"+jQuery(this).data("denominazione")+" (&euro; "+jQuery(this).data("importo")+")</h2>",html+='<p class="annfu_text_left">'+jQuery(this).data("descrizione")+"</p>",html+="<br/><br/><small>In base alla stagione, i fiori potrebbero essere diversi da quelli rappresentati in figura</small>",jQuery("#annfu_modal_fiori .modal-body").html(html),jQuery("#annfu_modal_fiori").modal("show"),writeLog("fiori",location.href,"apertura dettaglio "+jQuery(this).data("denominazione"))}),jQuery("input[name=fiore_id]").on("click",function(){if(controllaFiori(),jQuery(".annfu_fiore").removeClass("checked"),jQuery(this).parents(".annfu_fiore").addClass("checked"),img_path=jQuery(this).parents(".annfu_fiore").find("img").attr("src"),totale=calcolaImporto(),jQuery("#annfu_totale_ordine").html(totale.toFixed(2).replace(".",",")),jQuery(".annfu_totale_ordine").html(totale.toFixed(2).replace(".",",")),jQuery(".annfu_totale_fiore").html('<img src="'+img_path+'" class="annfu_totale_fiore_fiore" /> <strong>Composizione<br/></strong>'+jQuery(this).data("denominazione")),1==jQuery(this).data("testo")){var a=jQuery(this).data("max-caratteri"),b=a<60?1:4;jQuery("#annfu_fiore_testo_fascia").attr("maxlength",a).attr("rows",b),a<99999?jQuery("#annfu_fiore_testo_fascia").attr("placeholder","Testo da inserire nella fascia (max "+a+" caratteri)"):jQuery("#annfu_fiore_testo_fascia").attr("placeholder","Testo da inserire nella fascia"),jQuery("#annfu_fiore_testo_fascia_wrapper").show()}else jQuery("#annfu_fiore_testo_fascia").val(""),jQuery("#annfu_fiore_testo_fascia_wrapper").hide();writeLog("fiori",location.href,"selezionato fiore dettaglio "+jQuery(this).data("denominazione"))}),jQuery(".fiore_controllato").on("blur",function(){controllaFiori()}),jQuery("#annfu_privacy_fiori").on("click",function(){jQuery(this).is(":checked")?(jQuery("#annfu_error").html(""),jQuery("#annfu_ordina").prop("disabled",!1).removeClass("annfu_ordina_disabled")):jQuery("#annfu_ordina").prop("disabled","disabled").addClass("annfu_ordina_disabled")}),jQuery("#annfu_fiori_form").on("submit",function(b){if(b.preventDefault(),writeLog("fiori",location.href,"invio form"),confirm("Cliccando su ok confermi di voler proseguire con l'ordine.\nProseguendo, riceverai successivamente una email di conferma.\nSe invece vuoi annullare l'ordine, clicca su annulla.")){var a=controllaFiori();if(0==a.length){var c=jQuery("#annfu_fiore_token").val(),d=jQuery("#annfu_fiore_hash").val(),e=jQuery("input[name=fiore_id]:checked").val(),f=jQuery("#annfu_fiore_nome").val(),g=jQuery("#annfu_fiore_cognome").val(),h=jQuery("#annfu_fiore_mail").val(),i=jQuery("#annfu_fiore_telefono").val();jQuery("#annfu_fiore_quantita").val();var j=jQuery("#annfu_fiore_testo_fascia").val(),k=jQuery("#annfu_fiore_testo_biglietto").val(),l=jQuery("#annfu_fiore_note").val(),m=jQuery("#annfu_totale_ordine").text().replace(",",".");jQuery("#annfu_fiori_avanzamento").show(),jQuery.ajax({url:"https://admin.annuncifunebri.it/api/v2/fiore_ordine",data:{token:c,hash:d,fiore_id:e,nome:f,cognome:g,email:h,telefono:i,testo_fascia:j,testo_biglietto:k,note:l,quantita:1,importo:m},method:"POST",crossDomain:!0,dataType:"jsonp",success:function(a){if(200==a.status.code){var b=jQuery("#annfu_fiore_note").val();jQuery("#annfu_error").html(""),jQuery("#annfu_paga_fiori_avanzamento").css({color:"#0e5422"}),jQuery("#annfu_ordina").prop("disabled","disabled").addClass("annfu_ordina_disabled"),jQuery(".annfu_indicazioni_fiori").hide(),jQuery("#accordion").remove().end(),jQuery("#annfu_fiori_avanzamento").text(""),""!=b&&jQuery(".annfu_totale_note").html("<strong>Note per la fioreria</strong><br/>"+b),jQuery("#annfu_paga").show(),null!==a.data.ordine.paypal&&""!==a.data.ordine.paypal&&jQuery("#annfu_paga_button").html('<a href="'+a.data.ordine.paypal+"/"+m+'" target="_blank" class="annfu_btn_paypal btn btn-default btn-block">paga con PayPal</a>'),null!==a.data.ordine.modalita_pagamento_fiori&&jQuery("#annfu_paga_modalita_pagamento").html(a.data.ordine.modalita_pagamento_fiori),writeLog("fiori",location.href,"SUCCESSO invio form")}else jQuery("#annfu_fiori_avanzamento").css({color:"#c00"}),jQuery("#annfu_fiori_avanzamento").text(a.status.message),writeLog("fiori",location.href,"ERRORE invio form: "+a.status.message);jQuery("#annfu_paga_fiori_avanzamento").text(a.status.message)},error:function(a){writeLog("fiori",location.href,"ERRORE invio form: "+a),jQuery("#annfu_fiori_avanzamento").css({color:"#c00"}),jQuery("#annfu_fiori_avanzamento").text("Errore nell'invio dell'ordine. Si prega di riprovare.")}})}else jQuery("#annfu_error").html(a.join("<br/>"))}}),jQuery("#annfu_paga_button").on("click","a",function(){writeLog("fiori",location.href,"click paypal: "+jQuery(this).attr("href"))}),jQuery("#annfu_tabs a").click(function(a){a.preventDefault(),jQuery(this).tab("show")}),jQuery(".annfu_opere_bene_a").click(function(){writeLog("donazioni",location.href,"click "+jQuery(this).data("ob")+": "+jQuery(this).attr("href"))}),jQuery("#annfu_filter_front").on("click",function(){jQuery(".annfu_annunci_filter .back form").removeClass("hidden"),jQuery(".annfu_annunci_filter").removeClass("annfu_annunci_filter_front").addClass("annfu_annunci_filter_back")}),jQuery("#annfu_filter_back").on("click",function(){jQuery(".annfu_annunci_filter").removeClass("annfu_annunci_filter_back").addClass("annfu_annunci_filter_front")});var provinciaOptions=jQuery(".annfu_provincia").html();jQuery(".annfu_regione").on("change",function(){selected=jQuery(".annfu_regione option:selected").val(),jQuery(".annfu_provincia").html(provinciaOptions),jQuery(".annfu_provincia option:not(.r_"+selected+")").remove(),jQuery(".annfu_provincia").prepend('<option value="" selected="selected" class="seleziona">Seleziona provincia</option>'),jQuery("select").trigger("change.select2")}),selected=jQuery(".annfu_regione option:selected").val(),jQuery(".annfu_provincia option").show(),jQuery(".annfu_provincia option:not(.r_"+selected+")").hide(),jQuery("select").select2(),jQuery(".datepicker").datepicker({dateFormat:"dd/mm/yy"}),jQuery(".annfu_privacy").on("click",function(){jQuery("#annfu_modal_privacy").modal("show")}),jQuery(".annfu_testi").on("click",function(){jQuery("#annfu_modal_testi").modal("show")}),jQuery(".annfu_copia_testo").on("click",function(){jQuery("#annfu_testo").val(jQuery(this).prev().text()),jQuery("#annfu_modal_testi").modal("hide")}),jQuery("#annfu_carousel").carousel({interval:!1})